# 事务(transaction)

### 特性：ACID

+ Atomicity(原子性)：一个事务必须被视为一个不可分割的最小工作单元，整个事务的所有操作要么全部提交成功，要么全部失败回滚，不可能只执行其中的一部分操作。
+ Consistency(一致性)：数据库总是从一个一致状态到另一个一致状态
+ Isolation(隔离性)：通常来说，一个事务所做的修改在最终提交之前，对其他事务是不可见的，这里“通常来说”决定于隔离级别
+ Durability(持久性)：一旦事务提交，则其所做的修改就会永久保存到数据库中。此时即使系统崩溃，修改的数据也不会丢失。

### 隔离级别

|                      | 脏读 | 不可重复读 | 幻读 | 加锁读 |
| :------------------: | :--: | :--------: | :--: | :----: |
| **Read Uncommitted** | Yes  |    Yes     | Yes  |        |
|  **Read Committed**  |      |    Yes     | Yes  |        |
| **Repeatable Read**  |      |            | Yes  |        |
|   **Serializable**   |      |            |      |  Yes   |

### explain

+ **快照读**：快照读的数据可以看作一个快照，其他事务的修改不会改变这个快照值。也就是说快照读的数据不一定是最新值，可重复读级别也因此才保证了 “可重复读”。<span style={{color: 'red'}}>快照读的优势是不用加锁，并发效率高</span>。
+ **当前读**：当前读指的就是读的是最新值。既然是要求是最新值，那么就需要进行加锁限制，所以当前读是需要加锁的，同时因为当前读一定是最新的数据，所以就无法保证 “可重复读”。

### 幻读解决：

+ next-key lock
+ mvcc

### mvcc

+ undo log
+ read view